# BLUE: ENV_NAME=prod docker compose -p was-blue -f docker-compose.bg.yml up -d
# GREEN: ENV_NAME=dev docker compose -p was-green -f docker-compose.bg.yml up -d
services:
  daeng-backend:
    image: ${DOCKER_IMAGE_REPO}:${DOCKER_IMAGE_TAG}
    container_name: daeng-backend-${COLOR}
    restart: unless-stopped
    ports:
      - "${HOST_PORT}:8080"
    environment: SPRING_PROFILES_ACTIVE=${ENV_NAME}
    env_file:
      - /opt/app/backend/.env
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "curl -fsS http://localhost:8080/api/v3/health >/dev/null || exit 1",
        ]
      interval: 5s
      timeout: 2s
      retries: 12
      start_period: 20s
